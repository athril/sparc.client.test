name: Create Release

on:
  push:
    tags:
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10
  pull_request:
    tags:
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10


jobs:
  publish:
    name: publish
    runs-on: ubuntu-latest
    if: github.ref != 'refs/heads/main'
    permissions:
      contents: write
      discussions: write
#      pull-requests: write
#      repository-projects: write
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
#    - name: Create tag artifact
#      uses: actions/upload-artifact@v2
#      with:
#        name: ${{github.ref_name}}
#        path: Release
    - name: Build
      run: echo ${{ github.sha }} > Release.txt
    - name: Test
      run: cat Release.txt
    - name: Release
#      uses: softprops/action-gh-release@v1
      uses: pipe-cd/actions-gh-release@v2.3.4
      if: startsWith(github.ref, 'refs/tags/')
      with: 
        body_path: Release.txt
        generate_release_notes: true
        token: ${{ secrets.GITHUB_TOKEN }}
        draft: false
        prerelease: false
        files: |
          Release.txt


    #        body_path: ${{ github.workspace }}/CHANGELOG.md
#
#      env:
#        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
#
#    - name: Create Release
#      uses: actions/create-release@v1
#      id: create_release
#      with:
#        tag_name: ${{ github.ref }}
#        release_name: Release ${{ github.ref }}
#        body_path: CHANGELOG.md
#        draft: false
#        prerelease: false
